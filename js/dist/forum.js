(()=>{var o={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return o.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)o.o(n,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(o,t)=>Object.prototype.hasOwnProperty.call(o,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=o.n(t);const r=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/components/HeaderSecondary"];var a=o.n(e);const i=flarum.core.compat["forum/components/SessionDropdown"];var s=o.n(i);const c=flarum.core.compat["forum/components/LogInModal"];var l=o.n(c);const u=flarum.core.compat["forum/components/SignUpModal"];var f=o.n(u);const d=flarum.core.compat["common/components/Button"];var p=o.n(d);n().initializers.add("aditya-wiguna-jwt-sso",(function(){var o=function(o,t){void 0===t&&(t=null);try{return n().forum&&n().forum.attribute?n().forum.attribute(o):t}catch(o){return t}},t=function(){try{return o("baseUrl")||o("url")||""}catch(o){return""}},e=function(){var e=o("jwt-sso.overrideLogin",!1),i=t()+"/auth/sso/login";if(e){(0,r.override)(l().prototype,"oninit",(function(o){window.location.href=i})),(0,r.override)(f().prototype,"oninit",(function(o){window.location.href=i}));var c=n().modal.show;n().modal.show=function(o){if(o!==l()&&o!==f()){for(var t=arguments.length,r=new Array(t>1?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];return c.call.apply(c,[n().modal,o].concat(r))}window.location.href=i},(0,r.extend)(a().prototype,"items",(function(o){n().session.user||(o.has("logIn")&&o.replace("logIn",p().component({className:"Button Button--link",onclick:function(o){return o.preventDefault(),o.stopPropagation(),window.location.href=i,!1}},n().translator.trans("core.forum.header.log_in_link"))),o.has("signUp")&&o.remove("signUp"))})),(0,r.extend)(s().prototype,"items",(function(o){n().session.user||(o.has("logIn")&&o.replace("logIn",p().component({className:"Button Button--link",onclick:function(o){return o.preventDefault(),o.stopPropagation(),window.location.href=i,!1}},n().translator.trans("core.forum.header.log_in_link"))),o.has("signUp")&&o.remove("signUp"))})),n().routes.register=function(){window.location.href=i}}else(0,r.extend)(l().prototype,"fields",(function(o){o.add("sso-login",m("div",{className:"Form-group"},m(p(),{className:"Button Button--primary Button--block",onclick:function(){window.location.href=i}},n().translator.trans("jwt-sso.forum.login_with_sso",{},"Login with SSO"))),-10)}));(0,r.extend)(s().prototype,"items",(function(o){n().session.user&&o.replace("logOut",p().component({icon:"fas fa-sign-out-alt",onclick:function(){fetch(t()+"/auth/sso/logout",{method:"POST",headers:{"X-CSRF-Token":n().session.csrfToken}}).then((function(){window.location.reload()})).catch((function(){n().session.logout()}))}},n().translator.trans("core.forum.header.log_out_button")))}));var u=new URLSearchParams(window.location.search).get("sso_error");if(u){var d;switch(u){case"missing_token":d=n().translator.trans("jwt-sso.forum.error.missing_token",{},"Missing authentication token");break;case"invalid_state":d=n().translator.trans("jwt-sso.forum.error.invalid_state",{},"Invalid authentication state");break;case"invalid_token":d=n().translator.trans("jwt-sso.forum.error.invalid_token",{},"Invalid authentication token");break;case"authentication_failed":d=n().translator.trans("jwt-sso.forum.error.authentication_failed",{},"Authentication failed");break;default:d=n().translator.trans("jwt-sso.forum.error.generic",{error:u},"Authentication error: "+u)}n().alerts.show({type:"error",content:d}),window.history&&window.history.replaceState&&window.history.replaceState({},document.title,window.location.pathname)}},i=function(o,t){if(void 0===o&&(o=1),void 0===t&&(t=50),n().forum&&(n().forum.data||n().forum.attribute))try{e()}catch(o){console.error("JWT SSO initialization error:",o)}else if(o<t)setTimeout((function(){return i(o+1,t)}),100);else{console.warn("JWT SSO: Could not initialize - forum data not available after",t,"attempts");try{e()}catch(o){console.error("JWT SSO fallback initialization failed:",o)}}};i()}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map